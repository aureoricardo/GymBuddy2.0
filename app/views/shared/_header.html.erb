<div class="app-header <%= 'transparent' if current_page?(workouts_path) %>">
  <% unless current_page?(workouts_path) %>
    <h1 class="app-title">GymBuddy</h1>
  <% end %>

  <div class="header-actions">
    <% if current_page?(profile_path) %>
      <button onclick="toggleSettingsMenu()" class="settings-button" title="Settings">
        <svg xmlns="http://www.w3.org/2000/svg" class="settings-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 6V4m0 16v-2m8-8h2m-18 0H2m15.36-6.36l1.42 1.42M6.34 17.66l-1.42 1.42m0-13.08l1.42 1.42M17.66 17.66l-1.42 1.42M12 8a4 4 0 100 8 4 4 0 000-8z" />
        </svg>
      </button>
    <% end %>

    <% if current_page?(home_path) %>


    <%= render "shared/user_search_bar" %>

      <button onclick="toggleSMakePost()" class="settings-button" title="Upload">
        <svg xmlns="http://www.w3.org/2000/svg" class="settings-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 6V4m0 16v-2m8-8h2m-18 0H2m15.36-6.36l1.42 1.42M6.34 17.66l-1.42 1.42m0-13.08l1.42 1.42M17.66 17.66l-1.42 1.42M12 8a4 4 0 100 8 4 4 0 000-8z" />
        </svg>
      </button>
    <% end %>

    <% if current_page?(workouts_path) %>
      <div class="input-wrapper">
        <input id="shared-input" type="text" name="query" placeholder="" autocomplete="off" style="display:none;" />
        <form id="suggest-form" action="<%= suggestions_path %>" method="post" style="display:none;" class="suggest-form">
          <%= csrf_meta_tags %>
          <textarea id="shared-textarea" name="content" placeholder="Write your suggestion..." rows="1" required></textarea>
          <div class="form-buttons">
            <button type="submit">Send</button>
          </div>
        </form>
      </div>

      <div id="action-buttons" class="action-buttons">
        <button id="search-btn" class="icon-button" title="Search">üîç</button>
        <button id="suggest-btn" class="icon-button" title="Suggest">üí°</button>
      </div>
    <% end %>
  </div>
</div>

<!-- Mobile-style Make Post Modal -->
<div id="makePostModal" class="fullscreen-modal">
  <div class="modal-body mobile-modal">
    <div class="modal-header">
      <h2>New Post</h2>
      <button onclick="closeModal('makePostModal')" class="close-btn">&times;</button>
    </div>

    <form id="makePostForm" action="<%= posts_path %>" method="post" enctype="multipart/form-data" class="post-form">
      <%= hidden_field_tag :authenticity_token, form_authenticity_token %>

      <!-- Image Preview -->
      <div class="image-preview-wrapper">
        <img id="postImagePreview" src="#" alt="Preview" style="display:none;" />
      </div>

      <!-- File Input -->
      <input type="file" id="postImage" name="post[image]" accept="image/*">

      <!-- Caption -->
      <textarea name="post[content]" placeholder="What's on your mind?" rows="3" required></textarea>

      <!-- Tagging input -->
      <input type="text" name="post[tagged_usernames]" placeholder="Tag users (comma separated)" class="tag-input">

      <!-- Submit Button -->
      <button type="submit" class="submit-post-btn">Post</button>
    </form>
  </div>
</div>

<script>




  


// ‚úÖ Use your real overlay and menu IDs from settings_drawer partial
  function toggleSettingsMenu() {
    const menu = document.getElementById("settingsMenu");
    const overlay = document.getElementById("overlay"); // fixed ID
    const isOpen = menu.classList.contains("open");

    if (isOpen) {
      menu.classList.remove("open");
      overlay.classList.remove("show");
    } else {
      menu.classList.add("open");
      overlay.classList.add("show");
    }
  }


  function toggleSMakePost() {
    const modal = document.getElementById('makePostModal');
    modal.classList.toggle('open');
  }



  function closeModal(id) {
    document.getElementById(id).classList.remove('open');
  }

  // Image preview for post
  document.getElementById('postImage').addEventListener('change', function(e){
    const file = e.target.files[0];
    const preview = document.getElementById('postImagePreview');
    if(file){
      preview.src = URL.createObjectURL(file);
      preview.style.display = 'block';
    } else {
      preview.src = '#';
      preview.style.display = 'none';
    }
  });

  // Search/Suggest toggle for workouts page
  document.addEventListener('DOMContentLoaded', () => {
    const input = document.getElementById('shared-input');
    const suggestForm = document.getElementById('suggest-form');
    const textarea = document.getElementById('shared-textarea');

    const searchBtn = document.getElementById('search-btn');
    const suggestBtn = document.getElementById('suggest-btn');

    function reset() {
      input.style.display = 'none';
      input.value = '';
      suggestForm.style.display = 'none';
      textarea.value = '';
    }

    function showSearch() {
      reset();
      input.style.display = 'block';
      input.placeholder = 'Search workouts...';
      input.name = 'query';
      input.focus();
    }

    function showSuggest() {
      reset();
      suggestForm.style.display = 'flex';
      textarea.focus();
    }

    suggestForm.addEventListener('submit', (e) => {
      reset();
    });

    searchBtn.addEventListener('click', () => {
      if (input.style.display === 'block') {
        reset();
      } else {
        showSearch();
      }
    });

    suggestBtn.addEventListener('click', () => {
      if (suggestForm.style.display === 'flex') {
        reset();
      } else {
        showSuggest();
      }
    });
  });
</script>

<style>
/* Header styling */
.app-header {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 60px;
  padding: 0 16px;
  background-color: white;
  border-bottom: 1px solid #eee;
  position: sticky;
  top: 0;
  z-index: 50;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

.app-header.transparent {
  background-color: rgba(255, 255, 255, 0.6);
  border-bottom: none;
  border-radius: 0 0 16px 16px;
  backdrop-filter: blur(6px);
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 52px;
  z-index: 1000;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.app-title {
  font-size: 24px;
  font-weight: 800;
  color: #4a90e2;
  letter-spacing: 0.3em;
  padding: 6px 12px;
  text-shadow: 2px 2px 4px rgba(255,255,255,0.8), -2px -2px 4px rgba(255,255,255,0.8);
  background: rgba(255,255,255,0.3);
  border-radius: 12px;
}

.header-actions {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-grow: 1;
  justify-content: flex-end;
  max-width: 100%;
}

#action-buttons {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-shrink: 0;
}

.input-wrapper {
  flex-grow: 1;
  max-width: 400px;
  margin-right: 12px;
  display: flex;
  align-items: center;
  min-width: 0;
  box-sizing: border-box;
  overflow: hidden;
}

#shared-input {
  width: 100%;
  height: 32px;
  font-size: 14px;
  padding: 4px 8px;
  border: 1px solid #ccc;
  border-radius: 8px;
  line-height: 1.2;
  box-sizing: border-box;
}

.suggest-form {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 8px;
  border: 1px solid #ccc;
  border-radius: 8px;
  background: white;
  width: 100%;
  box-sizing: border-box;
  min-width: 0;
}

#shared-textarea {
  flex-grow: 1;
  flex-shrink: 1;
  min-width: 0;
  height: 32px;
  font-size: 14px;
  padding: 4px 8px;
  border: 1px solid #ccc;
  border-radius: 4px;
  resize: none;
}

.form-buttons {
  display: flex;
  gap: 6px;
  flex-shrink: 0;
}

.icon-button {
  font-size: 20px;
  background: none;
  border: none;
  cursor: pointer;
  user-select: none;
  padding: 6px;
}

.settings-button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 38px;
  height: 38px;
  border-radius: 50%;
  background: #f5f5f5;
  color: #333;
  transition: background 0.2s ease, transform 0.2s ease;
}

.settings-button:hover {
  background: #e6e6e6;
  transform: scale(1.05);
}

.settings-icon {
  width: 22px;
  height: 22px;
  stroke: currentColor;
}

/* Fullscreen modal styling */
.fullscreen-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
  z-index: 2000;
}

.fullscreen-modal.open {
  opacity: 1;
  pointer-events: all;
}

/* Mobile-style modal */
.mobile-modal {
  width: 100%;
  max-width: 500px;
  height: 100%;
  background: #fff;
  border-radius: 16px;
  justify-content: center;
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  padding: 12px;
  box-sizing: border-box;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-bottom: 8px;
  border-bottom: 1px solid #eee;
}

.close-btn {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
}

.post-form {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-top: 12px;
}

.image-preview-wrapper {
  width: 100%;
  height: 350px;
  background: #f0f0f0;
  border-radius: 12px;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
}

.image-preview-wrapper img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
  border-radius: 12px;
}

.post-form input[type="file"] {
  width: 100%;
}

.post-form textarea,
.tag-input {
  width: 100%;
  border-radius: 8px;
  border: 1px solid #ccc;
  padding: 8px;
  font-size: 14px;
  box-sizing: border-box;
  resize: vertical;
}

.submit-post-btn {
  background-color: #3b82f6;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 12px;
  font-size: 16px;
  cursor: pointer;
  transition: background 0.2s ease;
  margin-top: auto;
}

.submit-post-btn:hover {
  background-color: #2563eb;
}
</style>
