<% @saved_posts.each do |post| %>
  <div class="post-card" id="post-<%= post.id %>">
    <!-- Post Header -->
    <div class="post-header">
      <%= image_tag(avatar_url(post.user), class: "avatar") %>
      <div class="user-info">
        <h2 class="username"><%= post.user.username %></h2>
        <span class="time"><%= time_ago_in_words(post.created_at) %> ago</span>
      </div>
    </div>

    <!-- Post Content -->
    <div class="post-content">
      <p class="post-text"><%= post.content %></p>

      <% if post.image.attached? %>
        <% if post.image.content_type.start_with?('image') %>
          <img src="<%= url_for(post.image) %>" alt="Post Image" class="post-image">
        <% elsif post.image.content_type.start_with?('video') %>
          <video class="post-image" controls preload="metadata">
            <source src="<%= url_for(post.image) %>" type="<%= post.image.content_type %>">
            Your browser does not support the video tag.
          </video>
        <% end %>
      <% end %>
    </div>

    <!-- Post Actions -->
    <div class="post-actions">
      <button class="action-btn">‚ù§Ô∏è</button>
      <button class="action-btn">üí¨</button>
      <button class="action-btn">üîÑ</button>
      <button class="action-btn unsave-btn" data-post-id="<%= post.id %>">‚ùå Unsave</button>
    </div>
  </div>
<% end %>

<script>
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".unsave-btn").forEach(button => {
    button.addEventListener("click", () => {
      const postId = button.dataset.postId;

      fetch(`/saved_posts/${postId}/unsave`, {
        method: "DELETE",
        headers: {
          "X-CSRF-Token": document.querySelector('meta[name="csrf-token"]').content,
          "Accept": "application/json"
        }
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          // Remove the post card from DOM
          const postCard = document.getElementById(`post-${postId}`);
          if (postCard) postCard.remove();

          // Toast
          const toast = document.createElement("div");
          toast.textContent = "Post unsaved!";
          toast.style.position = "fixed";
          toast.style.top = "50%";
          toast.style.left = "50%";
          toast.style.transform = "translate(-50%, -50%)";
          toast.style.background = "#111";
          toast.style.color = "#fff";
          toast.style.padding = "12px 24px";
          toast.style.borderRadius = "12px";
          toast.style.zIndex = "9999";
          toast.style.opacity = "0.95";
          toast.style.fontWeight = "bold";
          toast.style.fontSize = "14px";
          document.body.appendChild(toast);
          setTimeout(() => toast.remove(), 1500);
        }
      });
    });
  });
});
</script>




<style>

  .tagged-users {
  margin-bottom: 8px;
  font-size: 13px;
  color: #555;
}

.tagged-username {
  font-weight: bold;
  margin-right: 4px;
}

.save-btn {
  color: #007bff;
}

.save-btn:hover {
  color: #0056b3;
}



.post-card {
  background: white;
  border-radius: 16px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  margin: 12px auto;
  max-width: 550px;
  overflow: hidden;
  font-family: system-ui, sans-serif;
  padding: 30px;
  margin-bottom: 110px;
}

.post-header {
  display: flex;
  align-items: center;
  padding: 12px;
  gap: 12px;
}

.avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  object-fit: cover;
}

.user-info {
  display: flex;
  flex-direction: column;
  
  
}

.username {
  font-weight: bold;
  font-size: 18px;
  color: black;
  
}

.time {
  font-size: 12px;
  color: #888;
}

.post-content {
  padding: 0 12px 12px;
}

.post-text {
  font-size: 14px;
  line-height: 1.4;
  margin-bottom: 8px;
}

.post-image {
  width: 100%;
  max-height: 400px;
  object-fit: cover;
  border-radius: 12px;
  margin-top: 8px;
}

.post-actions {
  display: flex;
  justify-content: space-around;
  padding: 8px 0;
  border-top: 1px solid #eee;
}

.action-btn {
  background: none;
  border: none;
  font-size: 16px;
  cursor: pointer;
  transition: transform 0.1s;
}

.action-btn:hover {
  transform: scale(1.1);
}

/* Mobile responsiveness */
@media (max-width: 480px) {
  .post-card { margin: 8px; }
  .post-image { max-height: 300px; }
}
</style>
